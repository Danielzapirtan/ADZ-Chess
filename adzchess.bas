10 REM ADZCHESS - Chess Engine in BASIC
20 REM Inspired by baeagn.c
30 REM Uses alpha-beta search with move generation
40 REM
50 REM Board representation: 8x8 + metadata row
60 REM Pieces: WP=1 WN=2 WB=3 WR=4 WQ=5 WK=6
70 REM        BP=-1 BN=-2 BB=-3 BR=-4 BQ=-5 BK=-6
80 REM
90 DIM B[72]
100 REM B[0-63] = board (y*8+x), B[64-67] = castle rights, B[68] = stm
110 DIM M[2000]
120 REM Move list: each move is 5 ints (fy, fx, ty, tx, promo)
130 DIM V[400]
140 REM Value list for sorting
150 DIM BL[60]
160 REM Best line storage
170 DIM TB[72]
180 REM Temporary board for makemove
190 DIM TM[2000]
200 REM Temporary move list
210 DIM S[500]
220 REM Search stack for alpha/beta values
230 REM
240 REM Constants
250 LET MAXV = 20000
260 LET PV = 100
270 LET NV = 315
280 LET BV = 325
290 LET RV = 500
300 LET QV = 980
310 LET MAXDEP = 6
320 REM
330 REM Global variables
340 LET NODES = 0
350 LET BLLEN = 0
360 LET STM = 0
370 REM
380 REM Initialize board from file
390 GOTO 10000
400 REM
410 REM Main search loop
420 LET DEP = 1
430 IF DEP > MAXDEP THEN 900
440 LET NODES = 0
450 LET ALPHA = 0
460 LET ALPHA = ALPHA - 20000
470 LET BETA = 20000
480 LET LEVEL = 0
490 PRINT "Searching depth "; DEP
500 GOTO 20000
510 REM Return from search, result in BSTV
520 PRINT "Depth: "; DEP
530 PRINT "Eval: "; BSTV
540 PRINT "Nodes: "; NODES
550 PRINT "Best: ";
560 LET I = 0
570 IF I >= BLLEN THEN 600
580 PRINT BL[I]; " ";
590 LET I = I + 1
600 GOTO 570
610 PRINT
620 LET DEP = DEP + 1
630 GOTO 430
640 REM
900 END
910 REM
1000 REM ==========================================
1010 REM LOAD BOARD FROM start.brd
1020 REM ==========================================
10000 REM Load board subroutine
10010 LET Y = 7
10020 IF Y < 0 THEN 10200
10030 LET X = 0
10040 IF X > 7 THEN 10180
10050 INPUT P
10060 LET IDX = Y
10070 LET IDX = IDX * 8
10080 LET IDX = IDX + X
10090 LET B[IDX] = P
10100 LET X = X + 1
10110 GOTO 10040
10180 LET Y = Y - 1
10190 GOTO 10020
10200 REM Load metadata
10210 LET B[64] = 1
10220 LET B[65] = 1
10230 LET B[66] = 0
10240 LET B[67] = 0
10250 INPUT STM
10260 LET B[68] = STM
10270 REM Transpose if black to move
10280 IF STM = 0 THEN 10350
10290 GOTO 11000
10300 REM Return from transpose
10350 GOTO 400
10360 REM
11000 REM ==========================================
11010 REM TRANSPOSE BOARD (flip colors and ranks)
11020 REM ==========================================
11030 LET Y = 0
11040 IF Y > 3 THEN 11250
11050 LET X = 0
11060 IF X > 7 THEN 11230
11070 LET I1 = Y
11080 LET I1 = I1 * 8
11090 LET I1 = I1 + X
11100 LET I2 = 7
11110 LET I2 = I2 - Y
11120 LET I2 = I2 * 8
11130 LET I2 = I2 + X
11140 LET T = B[I1]
11150 LET B[I1] = B[I2]
11160 LET B[I2] = T
11170 LET X = X + 1
11180 GOTO 11060
11230 LET Y = Y + 1
11240 GOTO 11040
11250 REM Negate all pieces
11260 LET I = 0
11270 IF I > 63 THEN 11350
11280 LET T = B[I]
11290 LET T = 0 - T
11300 LET B[I] = T
11310 LET I = I + 1
11320 GOTO 11270
11350 REM Swap castle rights
11360 LET T = B[64]
11370 LET B[64] = B[66]
11380 LET B[66] = T
11390 LET T = B[65]
11400 LET B[65] = B[67]
11410 LET B[67] = T
11420 GOTO 10300
11430 REM
20000 REM ==========================================
20010 REM ALPHABETA SEARCH - Entry point
20020 REM Input: DEP=depth, ALPHA, BETA
20030 REM Output: BSTV=best value, BLLEN, BL[]=line
20040 REM ==========================================
20050 LET STKP = 0
20060 LET CURLV = 0
20070 LET CURDP = DEP
20080 GOTO 21000
20090 REM Return from search with BSTV
20100 GOTO 510
20110 REM
21000 REM ==========================================
21010 REM SEARCH at current level
21020 REM Uses CURLV (level), CURDP (depth remaining)
21030 REM Uses ALPHA, BETA from stack or globals
21040 REM ==========================================
21050 REM Evaluate position
21060 GOTO 30000
21070 REM Return with EVAL
21080 LET VAL = EVAL
21090 REM Check if terminal
21100 IF VAL < 0 THEN 21120
21110 GOTO 21150
21120 LET T = 0 - 15000
21130 IF VAL < T THEN 21400
21150 IF CURDP > 0 THEN 21200
21160 LET BSTV = VAL
21170 GOTO 21400
21200 REM Generate moves
21210 GOTO 40000
21220 REM Return with MCNT moves in M[]
21230 IF MCNT > 0 THEN 21280
21240 LET BSTV = 0
21250 LET BSTV = BSTV - MAXV
21260 LET BSTV = BSTV + CURLV
21270 GOTO 21400
21280 REM Search all moves
21290 LET BSTV = 0
21300 LET BSTV = BSTV - MAXV
21310 LET MIDX = 0
21320 IF MIDX >= MCNT THEN 21400
21330 REM Make move MIDX
21340 GOTO 50000
21350 REM Recurse
21360 LET CURLV = CURLV + 1
21370 LET CURDP = CURDP - 1
21380 LET T = 0 - BETA
21390 LET ALPHA = T
21400 LET T = 0 - ALPHA
21410 LET BETA = T
21420 GOTO 21000
21430 REM Return from recursion with BSTV
21440 LET VAL = 0 - BSTV
21450 REM Unmake move
21460 GOTO 51000
21470 REM Update best
21480 IF VAL <= BSTV THEN 21550
21490 LET BSTV = VAL
21500 REM Update alpha
21510 IF BSTV <= ALPHA THEN 21550
21520 LET ALPHA = BSTV
21530 IF ALPHA < BETA THEN 21550
21540 GOTO 21400
21550 LET MIDX = MIDX + 1
21560 GOTO 21320
21570 REM
21400 REM Return from search level
21410 IF CURLV > 0 THEN 21430
21420 GOTO 20100
21430 REM Multi-level return
21440 LET CURLV = CURLV - 1
21450 LET CURDP = CURDP + 1
21460 GOTO 21430
21470 REM
30000 REM ==========================================
30010 REM EVALUATE POSITION
30020 REM Output: EVAL
30030 REM ==========================================
30040 LET NODES = NODES + 1
30050 LET EVAL = 0
30060 LET Y = 0
30070 IF Y > 7 THEN 30700
30080 LET X = 0
30090 IF X > 7 THEN 30680
30100 LET IDX = Y
30110 LET IDX = IDX * 8
30120 LET IDX = IDX + X
30130 LET P = B[IDX]
30140 IF P = 0 THEN 30660
30150 REM White pieces
30160 IF P = 1 THEN 30200
30170 IF P = 2 THEN 30270
30180 IF P = 3 THEN 30300
30190 IF P = 4 THEN 30330
30200 IF P = 5 THEN 30360
30210 IF P = 6 THEN 30660
30220 REM Black pieces
30230 IF P <> 0 THEN 30250
30240 GOTO 30390
30250 LET T = 0 - 1
30260 IF P = T THEN 30420
30270 LET T = 0 - 2
30280 IF P = T THEN 30490
30290 LET T = 0 - 3
30300 IF P = T THEN 30520
30310 LET T = 0 - 4
30320 IF P = T THEN 30550
30330 LET T = 0 - 5
30340 IF P = T THEN 30580
30350 GOTO 30660
30360 REM White pawn value by rank
30200 IF Y < 4 THEN 30240
30210 IF Y = 4 THEN 30250
30220 IF Y = 5 THEN 30260
30230 IF Y = 6 THEN 30270
30240 LET EVAL = EVAL + 100
30245 GOTO 30660
30250 LET EVAL = EVAL + 120
30255 GOTO 30660
30260 LET EVAL = EVAL + 200
30265 GOTO 30660
30270 LET EVAL = EVAL + 400
30275 GOTO 30660
30280 REM White knight
30270 LET EVAL = EVAL + NV
30280 GOTO 30660
30290 REM White bishop
30300 LET EVAL = EVAL + BV
30310 GOTO 30660
30320 REM White rook
30330 LET EVAL = EVAL + RV
30340 GOTO 30660
30350 REM White queen
30360 LET EVAL = EVAL + QV
30370 GOTO 30660
30380 REM Black pawn
30420 LET T = 7
30430 LET T = T - Y
30440 IF T < 4 THEN 30470
30450 IF T = 4 THEN 30480
30460 IF T = 5 THEN 30490
30470 IF T = 6 THEN 30500
30480 LET EVAL = EVAL - 100
30485 GOTO 30660
30490 LET EVAL = EVAL - 120
30495 GOTO 30660
30500 LET EVAL = EVAL - 200
30505 GOTO 30660
30510 LET EVAL = EVAL - 400
30515 GOTO 30660
30520 REM Black knight
30490 LET EVAL = EVAL - NV
30500 GOTO 30660
30510 REM Black bishop
30520 LET EVAL = EVAL - BV
30530 GOTO 30660
30540 REM Black rook
30550 LET EVAL = EVAL - RV
30560 GOTO 30660
30570 REM Black queen
30580 LET EVAL = EVAL - QV
30590 GOTO 30660
30660 LET X = X + 1
30670 GOTO 30090
30680 LET Y = Y + 1
30690 GOTO 30070
30700 REM Add centralization bonus
30710 LET Y = 0
30720 IF Y > 7 THEN 30900
30730 LET X = 0
30740 IF X > 7 THEN 30880
30750 LET X1 = X
30760 LET Y1 = Y
30770 IF X1 <= 3 THEN 30810
30780 LET X1 = 7
30790 LET X1 = X1 - X
30810 IF Y1 <= 3 THEN 30850
30820 LET Y1 = 7
30830 LET Y1 = Y1 - Y
30850 LET CDIST = X1
30860 IF Y1 < X1 THEN 30890
30870 LET CDIST = Y1
30890 LET CDIST = CDIST + 1
30900 LET IDX = Y
30910 LET IDX = IDX * 8
30920 LET IDX = IDX + X
30930 LET P = B[IDX]
30940 IF P > 0 THEN 30980
30950 IF P < 0 THEN 31020
30960 GOTO 31060
30980 LET EVAL = EVAL + CDIST
30990 GOTO 31060
31020 LET T = 0 - CDIST
31030 LET EVAL = EVAL + T
31060 LET X = X + 1
31070 GOTO 30740
31880 LET Y = Y + 1
31890 GOTO 30720
31900 GOTO 21070
31910 REM
40000 REM ==========================================
40010 REM GENERATE MOVES
40020 REM Output: MCNT, M[] filled with moves
40030 REM ==========================================
40040 LET MCNT = 0
40050 LET Y = 7
40060 IF Y < 0 THEN 40900
40070 LET X = 0
40080 IF X > 7 THEN 40880
40090 LET IDX = Y
40100 LET IDX = IDX * 8
40110 LET IDX = IDX + X
40120 LET P = B[IDX]
40130 IF P <= 0 THEN 40860
40140 IF P = 1 THEN 60000
40150 IF P = 2 THEN 61000
40160 IF P = 3 THEN 62000
40170 IF P = 4 THEN 63000
40180 IF P = 5 THEN 64000
40190 IF P = 6 THEN 65000
40200 REM Return points from piece generators
40210 GOTO 40860
40860 LET X = X + 1
40870 GOTO 40080
40880 LET Y = Y - 1
40890 GOTO 40060
40900 GOTO 21220
40910 REM
50000 REM ==========================================
50010 REM MAKEMOVE - Apply move MIDX to board
50020 REM Saves board to TB[]
50030 REM ==========================================
50040 LET I = 0
50050 IF I > 71 THEN 50120
50060 LET TB[I] = B[I]
50070 LET I = I + 1
50080 GOTO 50050
50120 REM Get move coords
50130 LET MBASE = MIDX
50140 LET MBASE = MBASE * 5
50150 LET FY = M[MBASE]
50160 LET MBASE = MBASE + 1
50170 LET FX = M[MBASE]
50180 LET MBASE = MBASE + 1
50190 LET TY = M[MBASE]
50200 LET MBASE = MBASE + 1
50210 LET TX = M[MBASE]
50220 LET MBASE = MBASE + 1
50230 LET PROM = M[MBASE]
50240 REM Calculate indices
50250 LET FIDX = FY
50260 LET FIDX = FIDX * 8
50270 LET FIDX = FIDX + FX
50280 LET TIDX = TY
50290 LET TIDX = TIDX * 8
50300 LET TIDX = TIDX + TX
50310 REM Handle castling
50320 LET P = B[FIDX]
50330 IF P <> 6 THEN 50500
50340 IF FY <> 0 THEN 50500
50350 IF FX <> 4 THEN 50500
50360 IF TY <> 0 THEN 50500
50370 IF TX = 2 THEN 50410
50380 IF TX = 6 THEN 50450
50390 GOTO 50500
50410 LET B[0] = 0
50420 LET B[3] = 4
50430 LET B[64] = 0
50440 LET B[65] = 0
50445 GOTO 50500
50450 LET B[7] = 0
50460 LET B[5] = 4
50470 LET B[64] = 0
50480 LET B[65] = 0
50500 REM Handle promotion
50510 IF P <> 1 THEN 50600
50520 IF FY <> 6 THEN 50600
50530 IF PROM = 0 THEN 50570
50540 LET B[TIDX] = PROM
50550 LET B[FIDX] = 0
50560 GOTO 50700
50570 LET B[TIDX] = 5
50580 LET B[FIDX] = 0
50590 GOTO 50700
50600 REM Regular move
50610 LET B[TIDX] = B[FIDX]
50620 LET B[FIDX] = 0
50700 REM Transpose board
50710 GOTO 11000
50720 REM Return to search
50730 GOTO 21350
50740 REM
51000 REM ==========================================
51010 REM UNMAKE MOVE - Restore board from TB[]
51020 REM ==========================================
51030 LET I = 0
51040 IF I > 71 THEN 51110
51050 LET B[I] = TB[I]
51060 LET I = I + 1
51070 GOTO 51040
51110 GOTO 21470
51120 REM
60000 REM ==========================================
60010 REM GENERATE PAWN MOVES from Y,X
60020 REM ==========================================
60030 LET Y1 = Y
60040 LET Y1 = Y1 + 1
60050 IF Y1 > 7 THEN 60900
60060 LET IDX1 = Y1
60070 LET IDX1 = IDX1 * 8
60080 LET IDX1 = IDX1 + X
60090 IF B[IDX1] <> 0 THEN 60300
60100 REM Forward move
60110 IF Y <> 6 THEN 60180
60120 REM Promotion
60130 LET PROM = 5
60140 GOTO 70000
60150 REM Return, try other promos
60160 GOTO 60300
60180 GOTO 70000
60190 REM Return
60200 REM Double push from rank 1
60210 IF Y <> 1 THEN 60300
60220 LET Y2 = Y
60230 LET Y2 = Y2 + 2
60240 LET IDX2 = Y2
60250 LET IDX2 = IDX2 * 8
60260 LET IDX2 = IDX2 + X
60270 IF B[IDX2] <> 0 THEN 60300
60280 LET Y1 = Y2
60290 GOTO 70000
60300 REM Captures
60310 IF X <= 0 THEN 60500
60320 LET X1 = X
60330 LET X1 = X1 - 1
60340 LET Y1 = Y
60350 LET Y1 = Y1 + 1
60360 LET IDX1 = Y1
60370 LET IDX1 = IDX1 * 8
60380 LET IDX1 = IDX1 + X1
60390 IF B[IDX1] >= 0 THEN 60500
60400 IF Y <> 6 THEN 60460
60410 LET PROM = 5
60420 GOTO 70000
60430 GOTO 60500
60460 GOTO 70000
60500 IF X >= 7 THEN 60900
60510 LET X1 = X
60520 LET X1 = X1 + 1
60530 LET Y1 = Y
60540 LET Y1 = Y1 + 1
60550 LET IDX1 = Y1
60560 LET IDX1 = IDX1 * 8
60570 LET IDX1 = IDX1 + X1
60580 IF B[IDX1] >= 0 THEN 60900
60590 IF Y <> 6 THEN 60650
60600 LET PROM = 5
60610 GOTO 70000
60620 GOTO 60900
60650 GOTO 70000
60900 GOTO 40210
60910 REM
61000 REM ==========================================
61010 REM GENERATE KNIGHT MOVES from Y,X
61020 REM ==========================================
61030 LET DY = 2
61040 LET DX = 1
61050 GOTO 71000
61060 LET DY = 2
61070 LET DX = 0
61080 LET DX = DX - 1
61090 GOTO 71000
61100 LET DY = 0
61110 LET DY = DY - 2
61120 LET DX = 1
61130 GOTO 71000
61140 LET DY = 0
61150 LET DY = DY - 2
61160 LET DX = 0
61170 LET DX = DX - 1
61180 GOTO 71000
61190 LET DY = 1
61200 LET DX = 2
61210 GOTO 71000
61220 LET DY = 0
61230 LET DY = DY - 1
61240 LET DX = 2
61250 GOTO 71000
61260 LET DY = 1
61270 LET DX = 0
61280 LET DX = DX - 2
61290 GOTO 71000
61300 LET DY = 0
61310 LET DY = DY - 1
61320 LET DX = 0
61330 LET DX = DX - 2
61340 GOTO 71000
61900 GOTO 40210
61910 REM
62000 REM ==========================================
62010 REM GENERATE BISHOP MOVES from Y,X
62020 REM ==========================================
62030 LET DY = 1
62040 LET DX = 1
62050 GOTO 72000
62060 LET DY = 1
62070 LET DX = 0
62080 LET DX = DX - 1
62090 GOTO 72000
62100 LET DY = 0
62110 LET DY = DY - 1
62120 LET DX = 1
62130 GOTO 72000
62140 LET DY = 0
62150 LET DY = DY - 1
62160 LET DX = 0
62170 LET DX = DX - 1
62180 GOTO 72000
62900 GOTO 40210
62910 REM
63000 REM ==========================================
63010 REM GENERATE ROOK MOVES from Y,X
63020 REM ==========================================
63030 LET DY = 1
63040 LET DX = 0
63050 GOTO 72000
63060 LET DY = 0
63070 LET DY = DY - 1
63080 LET DX = 0
63090 GOTO 72000
63100 LET DY = 0
63110 LET DX = 1
63120 GOTO 72000
63130 LET DY = 0
63140 LET DX = 0
63150 LET DX = DX - 1
63160 GOTO 72000
63900 GOTO 40210
63910 REM
64000 REM ==========================================
64010 REM GENERATE QUEEN MOVES from Y,X
64020 REM ==========================================
64030 GOTO 63000
64040 REM After rook moves, do bishop
64050 GOTO 62000
64060 REM
65000 REM ==========================================
65010 REM GENERATE KING MOVES from Y,X
65020 REM ==========================================
65030 LET DY = 1
65040 LET DX = 1
65050 GOTO 71000
65060 LET DY = 1
65070 LET DX = 0
65080 GOTO 71000
65090 LET DY = 1
65100 LET DX = 0
65110 LET DX = DX - 1
65120 GOTO 71000
65130 LET DY = 0
65140 LET DX = 1
65150 GOTO 71000
65160 LET DY = 0
65170 LET DX = 0
65180 LET DX = DX - 1
65190 GOTO 71000
65200 LET DY = 0
65210 LET DY = DY - 1
65220 LET DX = 1
65230 GOTO 71000
65240 LET DY = 0
65250 LET DY = DY - 1
65260 LET DX = 0
65270 GOTO 71000
65280 LET DY = 0
65290 LET DY = DY - 1
65300 LET DX = 0
65310 LET DX = DX - 1
65320 GOTO 71000
65330 REM Castling
65340 IF Y <> 0 THEN 65900
65350 IF X <> 4 THEN 65900
65360 IF B[64] = 0 THEN 65900
65370 REM Kingside
65380 IF B[0] <> 4 THEN 65500
65390 IF B[1] <> 0 THEN 65500
65400 IF B[2] <> 0 THEN 65500
65410 IF B[3] <> 0 THEN 65500
65420 LET Y1 = 0
65430 LET X1 = 2
65440 GOTO 70000
65500 REM Queenside
65510 IF B[7] <> 4 THEN 65900
65520 IF B[6] <> 0 THEN 65900
65530 IF B[5] <> 0 THEN 65900
65540 LET Y1 = 0
65550 LET X1 = 6
65560 GOTO 70000
65900 GOTO 40210
65910 REM
70000 REM ==========================================
70010 REM ADD MOVE to move list
70020 REM Input: Y,X (from), Y1,X1 (to), PROM
70030 REM ==========================================
70040 LET MBASE = MCNT
70050 LET MBASE = MBASE * 5
70060 LET M[MBASE] = Y
70070 LET MBASE = MBASE + 1
70080 LET M[MBASE] = X
70090 LET MBASE = MBASE + 1
70100 LET M[MBASE] = Y1
70110 LET MBASE = MBASE + 1
70120 LET M[MBASE] = X1
70130 LET MBASE = MBASE + 1
70140 LET M[MBASE] = PROM
70150 LET MCNT = MCNT + 1
70160 LET PROM = 0
70170 REM Return to caller - multiple return points
70180 REM This is tricky