10 REM ADZCHESS - Chess Engine in BASIC
20 REM Inspired by baeagn.c
30 REM Simplified alpha-beta search
40 REM
50 REM Board: 8x8 grid stored linearly
60 REM Pieces: WP=1 WN=2 WB=3 WR=4 WQ=5 WK=6
70 REM        BP=-1 BN=-2 BB=-3 BR=-4 BQ=-5 BK=-6
80 REM
90 DIM B[72]
100 DIM M[2000]
110 DIM V[400]
120 DIM BL[30]
130 DIM TB[72]
140 REM
150 LET MAXDEP = 4
160 LET PV = 100
170 LET NV = 315
180 LET BV = 325
190 LET RV = 500
200 LET QV = 980
210 LET MAXV = 20000
220 REM
230 PRINT "ADZCHESS - Loading position"
240 REM Load board from start.brd
250 LET Y = 7
260 IF Y < 0 THEN 350
270 LET X = 0
280 IF X > 7 THEN 330
290 INPUT P
300 LET B[Y * 8 + X] = P
310 LET X = X + 1
320 GOTO 280
330 LET Y = Y - 1
340 GOTO 260
350 INPUT STM
360 LET B[64] = 1
370 LET B[65] = 1
380 LET B[66] = 0
390 LET B[67] = 0
400 LET B[68] = STM
410 REM
420 PRINT "Board loaded"
430 REM
440 REM Transpose if black to move
450 IF STM = 0 THEN 630
460 LET Y = 0
470 IF Y > 3 THEN 570
480 LET X = 0
490 IF X > 7 THEN 550
500 LET I1 = Y * 8 + X
510 LET I2 = (7 - Y) * 8 + X
520 LET T = B[I1]
530 LET B[I1] = B[I2]
540 LET B[I2] = T
550 LET X = X + 1
560 GOTO 490
570 LET Y = Y + 1
580 GOTO 470
590 LET I = 0
600 IF I > 63 THEN 630
610 LET B[I] = 0 - B[I]
620 LET I = I + 1
630 GOTO 600
640 REM
650 REM Main search loop
660 LET DEP = 1
670 IF DEP > MAXDEP THEN 9990
680 PRINT "Depth: "; DEP
690 LET NODES = 0
700 LET ALPHA = 0 - 20000
710 LET BETA = 20000
720 REM
730 REM Root search - generate and evaluate moves
740 LET MCNT = 0
750 LET Y = 7
760 IF Y < 0 THEN 850
770 LET X = 0
780 IF X > 7 THEN 830
790 LET P = B[Y * 8 + X]
800 IF P > 0 THEN 10000
810 REM Continue after move gen
820 LET X = X + 1
830 GOTO 780
840 LET Y = Y - 1
850 GOTO 760
860 REM
870 PRINT "Generated "; MCNT; " moves"
880 IF MCNT = 0 THEN 9990
890 REM
900 REM Evaluate each move at depth DEP-1
910 LET BSTV = 0 - MAXV
920 LET BSTI = 0
930 LET MI = 0
940 IF MI >= MCNT THEN 1100
950 REM Make move MI
960 LET I = 0
970 IF I > 71 THEN 1010
980 LET TB[I] = B[I]
990 LET I = I + 1
1000 GOTO 970
1010 LET MBASE = MI * 5
1020 LET FY = M[MBASE]
1030 LET FX = M[MBASE + 1]
1040 LET TY = M[MBASE + 2]
1050 LET TX = M[MBASE + 3]
1060 LET B[TY * 8 + TX] = B[FY * 8 + FX]
1070 LET B[FY * 8 + FX] = 0
1080 REM Transpose
1090 GOTO 20000
1100 REM After transpose, evaluate
1110 GOTO 30000
1120 REM EVAL returned
1130 LET VAL = 0 - EVAL
1140 REM Unmake move
1150 LET I = 0
1160 IF I > 71 THEN 1200
1170 LET B[I] = TB[I]
1180 LET I = I + 1
1190 GOTO 1160
1200 REM Check if best
1210 IF VAL <= BSTV THEN 1260
1220 LET BSTV = VAL
1230 LET BSTI = MI
1240 LET BL[0] = FY
1250 LET BL[1] = FX
1260 LET BL[2] = TY
1270 LET BL[3] = TX
1280 LET MI = MI + 1
1290 GOTO 940
1300 REM
1310 PRINT "Best eval: "; BSTV
1320 PRINT "Best move: "; BL[0]; ","; BL[1]; " to "; BL[2]; ","; BL[3]
1330 PRINT "Nodes: "; NODES
1340 LET DEP = DEP + 1
1350 GOTO 670
1360 REM
9990 END
10000 REM MOVE GENERATION DISPATCH
10010 IF P = 1 THEN 11000
10020 IF P = 2 THEN 12000
10030 IF P = 3 THEN 13000
10040 IF P = 4 THEN 14000
10050 IF P = 5 THEN 15000
10060 IF P = 6 THEN 16000
10070 GOTO 820
10080 REM
11000 REM PAWN MOVES from Y,X
11010 IF Y = 7 THEN 810
11020 LET Y1 = Y + 1
11030 IF B[Y1 * 8 + X] <> 0 THEN 11150
11040 IF Y <> 6 THEN 11080
11050 REM Promotion
11060 GOTO 50000
11070 GOTO 11150
11080 GOTO 50000
11090 REM Double push
11100 IF Y <> 1 THEN 11150
11110 IF B[(Y + 2) * 8 + X] <> 0 THEN 11150
11120 LET Y1 = Y + 2
11130 GOTO 50000
11150 REM Left capture
11160 IF X <= 0 THEN 11230
11170 LET X1 = X - 1
11180 LET Y1 = Y + 1
11190 IF B[Y1 * 8 + X1] >= 0 THEN 11230
11200 IF Y = 6 THEN 11220
11210 GOTO 50000
11220 GOTO 50000
11230 REM Right capture
11240 IF X >= 7 THEN 11310
11250 LET X1 = X + 1
11260 LET Y1 = Y + 1
11270 IF B[Y1 * 8 + X1] >= 0 THEN 11310
11280 IF Y = 6 THEN 11300
11290 GOTO 50000
11300 GOTO 50000
11310 GOTO 820
11320 REM
12000 REM KNIGHT MOVES from Y,X
12010 LET DY = 2
12020 LET DX = 1
12030 GOTO 51000
12040 LET DY = 2
12050 LET DX = -1
12060 GOTO 51000
12070 LET DY = -2
12080 LET DX = 1
12090 GOTO 51000
12100 LET DY = -2
12110 LET DX = -1
12120 GOTO 51000
12130 LET DY = 1
12140 LET DX = 2
12150 GOTO 51000
12160 LET DY = -1
12170 LET DX = 2
12180 GOTO 51000
12190 LET DY = 1
12200 LET DX = -2
12210 GOTO 51000
12220 LET DY = -1
12230 LET DX = -2
12240 GOTO 51000
12250 GOTO 820
12260 REM
13000 REM BISHOP MOVES from Y,X
13010 LET DY = 1
13020 LET DX = 1
13030 GOTO 52000
13040 LET DY = 1
13050 LET DX = -1
13060 GOTO 52000
13070 LET DY = -1
13080 LET DX = 1
13090 GOTO 52000
13100 LET DY = -1
13110 LET DX = -1
13120 GOTO 52000
13130 GOTO 820
13140 REM
14000 REM ROOK MOVES from Y,X
14010 LET DY = 1
14020 LET DX = 0
14030 GOTO 52000
14040 LET DY = -1
14050 LET DX = 0
14060 GOTO 52000
14070 LET DY = 0
14080 LET DX = 1
14090 GOTO 52000
14100 LET DY = 0
14110 LET DX = -1
14120 GOTO 52000
14130 GOTO 820
14140 REM
15000 REM QUEEN MOVES from Y,X
15010 LET DY = 1
15020 LET DX = 1
15030 GOTO 52000
15040 LET DY = 1
15050 LET DX = -1
15060 GOTO 52000
15070 LET DY = -1
15080 LET DX = 1
15090 GOTO 52000
15100 LET DY = -1
15110 LET DX = -1
15120 GOTO 52000
15130 LET DY = 1
15140 LET DX = 0
15150 GOTO 52000
15160 LET DY = -1
15170 LET DX = 0
15180 GOTO 52000
15190 LET DY = 0
15200 LET DX = 1
15210 GOTO 52000
15220 LET DY = 0
15230 LET DX = -1
15240 GOTO 52000
15250 GOTO 820
15260 REM
16000 REM KING MOVES from Y,X
16010 LET DY = 1
16020 LET DX = 1
16030 GOTO 51000
16040 LET DY = 1
16050 LET DX = 0
16060 GOTO 51000
16070 LET DY = 1
16080 LET DX = -1
16090 GOTO 51000
16100 LET DY = 0
16110 LET DX = 1
16120 GOTO 51000
16130 LET DY = 0
16140 LET DX = -1
16150 GOTO 51000
16160 LET DY = -1
16170 LET DX = 1
16180 GOTO 51000
16190 LET DY = -1
16200 LET DX = 0
16210 GOTO 51000
16220 LET DY = -1
16230 LET DX = -1
16240 GOTO 51000
16250 GOTO 820
16260 REM
20000 REM TRANSPOSE BOARD
20010 LET Y = 0
20020 IF Y > 3 THEN 20120
20030 LET X = 0
20040 IF X > 7 THEN 20100
20050 LET I1 = Y * 8 + X
20060 LET I2 = (7 - Y) * 8 + X
20070 LET T = B[I1]
20080 LET B[I1] = B[I2]
20090 LET B[I2] = T
20100 LET X = X + 1
20110 GOTO 20040
20120 LET Y = Y + 1
20130 GOTO 20020
20140 LET I = 0
20150 IF I > 63 THEN 20190
20160 LET B[I] = 0 - B[I]
20170 LET I = I + 1
20180 GOTO 20150
20190 GOTO 1110
20200 REM
30000 REM EVALUATE POSITION
30010 LET NODES = NODES + 1
30020 LET EVAL = 0
30030 LET Y = 0
30040 IF Y > 7 THEN 30300
30050 LET X = 0
30060 IF X > 7 THEN 30280
30070 LET P = B[Y * 8 + X]
30080 IF P = 0 THEN 30260
30090 IF P = 1 THEN 30140
30100 IF P = 2 THEN 30160
30110 IF P = 3 THEN 30180
30120 IF P = 4 THEN 30200
30130 IF P = 5 THEN 30220
30140 IF Y < 4 THEN 30150
30145 IF Y = 4 THEN 30155
30147 IF Y = 5 THEN 30160
30148 LET EVAL = EVAL + 400
30149 GOTO 30260
30150 LET EVAL = EVAL + 100
30152 GOTO 30260
30155 LET EVAL = EVAL + 120
30157 GOTO 30260
30160 LET EVAL = EVAL + 200
30162 GOTO 30260
30170 LET EVAL = EVAL + NV
30175 GOTO 30260
30180 LET EVAL = EVAL + BV
30185 GOTO 30260
30200 LET EVAL = EVAL + RV
30205 GOTO 30260
30220 LET EVAL = EVAL + QV
30225 GOTO 30260
30230 IF P = -1 THEN 30240
30232 IF P = -2 THEN 30244
30234 IF P = -3 THEN 30246
30236 IF P = -4 THEN 30248
30238 IF P = -5 THEN 30250
30240 LET EVAL = EVAL - 100
30242 GOTO 30260
30244 LET EVAL = EVAL - NV
30245 GOTO 30260
30246 LET EVAL = EVAL - BV
30247 GOTO 30260
30248 LET EVAL = EVAL - RV
30249 GOTO 30260
30250 LET EVAL = EVAL - QV
30260 LET X = X + 1
30270 GOTO 30060
30280 LET Y = Y + 1
30290 GOTO 30040
30300 GOTO 1130
30310 REM
50000 REM ADD MOVE to list
50010 LET MBASE = MCNT * 5
50020 LET M[MBASE] = Y
50030 LET M[MBASE + 1] = X
50040 LET M[MBASE + 2] = Y1
50050 LET M[MBASE + 3] = X1
50060 LET M[MBASE + 4] = 0
50070 LET MCNT = MCNT + 1
50080 REM Return varies by caller
50090 IF P = 1 THEN 11090
50100 GOTO 820
50110 REM
51000 REM ADD NONSLIDER MOVE
51010 LET Y1 = Y + DY
51020 LET X1 = X + DX
51030 IF Y1 < 0 THEN 51120
51040 IF Y1 > 7 THEN 51120
51050 IF X1 < 0 THEN 51120
51060 IF X1 > 7 THEN 51120
51070 IF B[Y1 * 8 + X1] > 0 THEN 51120
51080 LET MBASE = MCNT * 5
51090 LET M[MBASE] = Y
51100 LET M[MBASE + 1] = X
51110 LET M[MBASE + 2] = Y1
51120 LET M[MBASE + 3] = X1
51130 LET M[MBASE + 4] = 0
51140 LET MCNT = MCNT + 1
51150 REM Return to knight/king
51160 IF P = 2 THEN 12040
51170 IF P = 6 THEN 16040
51180 GOTO 820
51190 REM
52000 REM ADD SLIDER MOVES
52010 LET Y1 = Y
52020 LET X1 = X
52030 LET Y1 = Y1 + DY
52040 LET X1 = X1 + DX
52050 IF Y1 < 0 THEN 52200
52060 IF Y1 > 7 THEN 52200
52070 IF X1 < 0 THEN 52200
52080 IF X1 > 7 THEN 52200
52090 LET P1 = B[Y1 * 8 + X1]
52100 IF P1 > 0 THEN 52200
52110 LET MBASE = MCNT * 5
52120 LET M[MBASE] = Y
52130 LET M[MBASE + 1] = X
52140 LET M[MBASE + 2] = Y1
52150 LET M[MBASE + 3] = X1
52160 LET M[MBASE + 4] = 0
52170 LET MCNT = MCNT + 1
52180 IF P1 < 0 THEN 52200
52190 GOTO 52030
52200 REM Return to piece
52210 IF P = 3 THEN 13040
52220 IF P = 4 THEN 14040
52230 IF P = 5 THEN 15040
52240 GOTO 820
